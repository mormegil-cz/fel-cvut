<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
 "http://www.w3.org/TR/REC-html40/loose.dtd">

<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1250">
  <meta name="author" content="Petr Kadlec">
  
  <title>Stavebnice komplexních 3D scén</title>

  <link rel=StyleSheet href="gm.css" type="text/css" title="Stylesheet">  
</head>
<body lang=cz>
<h1>Stavebnice komplexních 3D scén &ndash; zpráva o&nbsp;øešení</h1>

<h2>Úvod</h2>
<p>Toto je zpráva o&nbsp;øešení semestrální práce z&nbsp;pøedmìtu 36GM, rozšíøené
do øešení semestrálního projektu (36SEM).

<h2>Zadání</h2>
<p>Navrnìte a&nbsp;implementujte systém umoòující rychlou tvorbu velmi
jednoduchıch komplexních 3D scén ve formátu VRML nebo X3D. K&nbsp;modelování
scény se pouijí existující jednodušší fragmenty scén a&nbsp;proces modelování
bude øízen jednoduchımi editovatelnımi skripty. Pomocí tìchto skriptù bude moné
jednoduše ovlivòovat veškeré vlastnosti budoucí scény a&nbsp;tak rychle generovat
rùzné tøídy velmi komplexních scén.
<ul>
  <li>Objekty se skládají ze základních stavebních kamenù (poloha dveøí je pøedem
      jasnì determinována).</li>
  <li>Omezovací pravidla pro tvorbu scény jsou zapsána pomocí gramatiky a&nbsp;implementována
      pøíslušnou datovou strukturou (automat, zás. automat, atd.).</li>
</ul>
<p>Toto bylo pùvodní zadání. V&nbsp;prùbìhu øešení se nìkteré vlastnosti mírnì
pozmìnily. Veškerá vstupní data (a na modely fragmentù ve VRML) jsou ve formátu
XML, místo speciální gramatiky pro omezující pravidla jsou tedy tato zapsána
pøímo v&nbsp;XML souboru.
<p>Rošíøení na semestrální projekt spoèívá právì v&nbsp;implementaci omezujících
pravidel (constraints), jejich vyhodnocování a&nbsp;hledání øešení s&nbsp;nejlepším
skóre, spolu s&nbsp;rozšíøením èinnosti programu na vícepatrové scény a&nbsp;místnosti.

<h2>Analıza a&nbsp;návrh</h2>
<p>Problém rozmístìní fragmentù do scény je NP-úplnı. Proto nemùeme oèekávat,
e by náš program dokázal v&nbsp;rozumném èase vyøešit libovolnou úlohu. Pøesto
mùeme pro bìné, nijak rozsáhlé úlohy oèekávat, e program øešení nalézt dokáe.
<p>Pro zhodnocení &bdquo;kvality&ldquo; øešení, s&nbsp;ohledem na zadaná omezení,
pouíváme <i>skóre</i>, které vyjadøuje, jak moc se øešení blíí takovému, jaké
oèekáváme. Èím kladnìjší je skóre, tím lepší øešení je. Naopak øešení mající skóre
rovno mínus nekoneènu bude zahozeno jako neodpovídající zadání. Kadé omezení
má pøiøazenu hodnotu, podle které se hodnotí jeho vıznamnost. Implicitní hodnotou
kadého omezení je nekoneèno, co zajišuje, e øešení nesplòující takové omezení
vùbec nebude uivateli prezentováno jako øešení.
<p>Základním algoritmem øešení je prohledávání do hloubky (DFS), naprogramované
pomocí rekurzivní funkce. Pøi prohledávání se kontroluje aktuální skóre a&nbsp;pøi
pøíliš nízké hodnotì skóre je mono provést návrat, pøestoe je stále mono umisovat
další místnosti. Tím se zkracuje doba nalezení rozumného øešení.

<h2>Implementace</h2>
<p>Celı program je implementován v&nbsp;Javì, s&nbsp;vyuitím knihovny Xerces
pro práci s&nbsp;XML soubory a&nbsp;knihovny CyberVRML97 pro práci s&nbsp;VRML/X3D
soubory.
<h3>Struènı pøehled organizace programu</h3>
<p>Program je obsaen v&nbsp;balíèku <code class=package>cs.cvut.felk.cs.gm.sceneautobuilder</code>
a&nbsp;je rozdìlen do pìti souborù:
<dl>
  <dt class=filename>BuildScene.java</dt>
  <dd>Spustitelná tøída programu. Obsahuje pouze metodu <code class=java>main</code>.</dd>
  
  <dt class=filename>Library.java</dt>
  <dd>Obsahuje tøídy pro práci s&nbsp;knihovnou místností. Hlavní tøída
      <code class=java>Library</code> umoòuje nahrát pøíslušnı XML soubor.</dd>
      
  <dt class=filename>SceneReq.java</dt>
  <dd>Obsahuje tøídy pro práci s&nbsp;poadavky na scénu. Hlavní tøída
      <code class=java>SceneReq</code> umoòuje nahrát pøíslušnı XML soubor.</dd>

  <dt class=filename>PlatformCell.java</dt>
  <dd>Obsahuje pouze dvì pomocné tøídy pro ukládání bunìk møíky.</dd>
  
  <dt class=filename>Solver.java</dt>
  <dd>Obsahuje tøídy hlavního jádra programu, které provádí vlastní øešení úlohy.
      Nejdùleitìjší je rekurzivní funkce <code class=java>recursiveSolve</code>
      tøídy <code class=java>Solver</code>. Ta provádí hlavní smyèku øešení.</dd>
</dl>      

<h2>Ukázky a&nbsp;testování</h2>
<p><a href="dist/sceneautobuilder.zip">Distribuce programu</a> obsahuje adresáø
<code class=filename>examples</code>, ve kterém jsou pøíklady pro testování
programu. Soubory <code class=filename>l_*.xml</code> obsahují popis knihovny
místností, soubory <code class=filename>s_*.xml</code> obsahují poadavky na scénu,
soubory <code class=filename>m_*.wml</code> jsou VRML soubory s&nbsp;modely místností
a <code class=filename>o_*.wml</code> jsou vısledné VRML soubory. Také je zde
soubor <code class=filename>include.wml</code>, kterı byl pouíván jako
<a href="spusteni.htm#options">include soubor</a> pøi zpracovávání pøíkladù.
<h3>Spuštìní pøíkladù</h3>
<p>Pro zjednodušení spouštìní pøíkladù existuje speciální spouštìcí soubor
<code class=filename>BuildExample.bat</code>, kterému pøedáte pouze název pøíkladu
(napø. <code class=cmdline>pentomino</code>, názvy jsou uvádìny v&nbsp;titulku).
Program se spouští z&nbsp;adresáøe, do kterého jste rozbalili program (ten, kterı
obsahuje hlavní spouštìcí soubor), napø.
<pre><kbd class=cmdline>examples\BuildExample pentomino</kbd></pre>
<p>Vıslednı soubor vznikne v&nbsp;aktuálním adresáøi, abyste mohli porovnávat
s&nbsp;ji dodanımi vısledky. Pro další zjednodušení existuje dávka
<code class=cmdline>BuildAllExamples.bat</code>, která postupnì spustí všechny pøíklady.  

<h3>Pøíklad 1 &ndash; Pentomino (<code class=filename>pentomino</code>)</h3>
<p>Na prvním pøíkladì ukáeme základní funkcionalitu programu &ndash; skládání
místností (aèkoliv to v&nbsp;tomto pøípadì místnosti nebudou&hellip;). Známá høíèka
Pentomino dává za úkol poskládat dvanáct pìtiètvereèkovıch kamenù na šachovnici,
ze které jsou odebrána ètyøi políèka. To je ale pøesnì to, co náš program umí,
proè ho tedy nepouít? Jako &bdquo;místnosti&ldquo; jsou zde definovány jednotlivé
kameny, pøièem u&nbsp;tìch kamenù, které mají dva rùzné tvary lišící se pøevrácením
obsahuje pøíslušná skupina tyto dva kameny. Poadavky na scénu pak obsahují tvar
šachovnice s&nbsp;vynechanımi poli a&nbsp;seznam skupin, pøièem poadují právì
jeden kámen z kadé skupiny.
<p class=center><a href="vrml/o_pentomino.wrl"><img src="img/priklad1.png" alt="Øešení 1. pøíkladu" width="508" height="317"></a>

<h3>Pøíklad 2 &ndash; Portály (<code class=filename>portaly</code>)</h3>
<p>Zde si ukáeme pouití portálù. Knihovna obsahuje tøi místnosti 3&times;1,
z&nbsp;nich jedna obsahuje jedny vnitøní dveøe, jedna jedny vnitøní dveøe a&nbsp;jedno
vnìjší okno a&nbsp;tøetí obsahuje dvoje vnitøní a&nbsp;jedny vnìjší dveøe. Scéna
pak vyaduje nejménì jednu místnost od kadého druhu. Existuje tedy jediné øešení
(a na otoèení celé scény), které program najde. 
<p class=center><a href="vrml/o_portaly.wrl"><img src="img/priklad2.png" alt="Øešení 2. pøíkladu" width="391" height="331"></a>

<h3>Pøíklad 3 &ndash; Omezení místností (<code class=filename>mistomez</code>)</h3>
<p>Zde si ukáeme omezení uvedené v&nbsp;knihovnì místností. Knihovna místností
obsahuje tøi typy místností, pøièem je poadováno, aby místnost <code class=xml>C1</code>
byla sousedem místností <code class=xml>C2</code> i <code class=xml>C3</code>. Z&nbsp;toho
vyplıvá, e místnost <code class=xml>C1</code> musí bıt umístìna uprostøed,
co také program správnì zjistí.
<p class=center><a href="vrml/o_mistomez.wrl"><img src="img/priklad3.png" alt="Øešení 3. pøíkladu" width="292" height="229"></a>

<h3>Pøíklad 4 &ndash; Omezení scény (<code class=filename>scenomez</code>)</h3>
<p>Zde si ukáeme omezení uvedené v&nbsp;poadavcích na scénu. Existuje jedinı
typ místnosti, která má na jedné stranì jedny dveøe, na druhé stranì troje dveøe,
pøièem všechny dveøe jsou druhu <code class=xml>inout</code>. V&nbsp;poadavcích
na scénu je uveden minimální poèet vıstupních dveøí, rovnı tøem. Dále zde mùete
experimentovat s&nbsp;tímto omezením, èím mùete dosáhnout libovolné ze ètyø
rùznıch platnıch rozmístìní místností.
<p class=center><a href="vrml/o_scenomez.wrl"><img src="img/priklad4.png" alt="Øešení 4. pøíkladu" width="362" height="323"></a>

<h3>Pøíklad 5 &ndash; Doma (<code class=filename>doma</code>)</h3>
<p>Zde si ukáeme jeden o&nbsp;trochu obecnìjší pøíklad.
<p class=center><a href="vrml/o_doma.wrl"><img src="img/priklad5.png" alt="Øešení 5. pøíkladu" width="587" height="345"></a>

<h3>Pøíklad 6 &ndash; Komplexní na závìr (<code class=filename>komplex</code>)</h3>
<p>Jako pøedposlední pøíklad si ukáeme komplexnìjší scénu. Knihovna místností obsahuje ponìkud vyšší
poèet místností, uspoøádanıch do skupin <code class=xml>pokoj, kuchyne, wc</code>. Scéna
pak vyaduje nejménì jednu kuchyò, jedno wc a&nbsp;tøi pokoje. V&nbsp;pøíkladu je té ukázáno
pouití vıplòové místnosti. V&nbsp;pøíkladu je dále pouito omezení, ádající
jistou minimální vzdálenost mezi wc a kuchyní. Nakonec jsou bezpodmíneènì vyadovány
nejménì jedny dveøe ven.
<p>Na tomto pøíkladu je vidìt jeden velkı problém scén generovanıch tímto programem &ndash; nepropojenost.
Více viz <a href="#notes">poznámky na závìr</a>.
<p class=center><a href="vrml/o_komplex.wrl"><img src="img/priklad6.png" alt="Øešení 6. pøíkladu" width="551" height="387"></a>

<h3>Pøíklad 7 &ndash; A jako pøídavek: Vícepatrové scény (<code class=filename>schody</code>)</h3>
<p>Na úplnı závìr si ukáeme scénu, která není jako všechny pøedchozí &bdquo;placatá&ldquo;, ale má
dvì patra, pøièem mezi místnostmi jsou místnosti, obsahující schody. Je vidìt,
e program nemá potíe ani s&nbsp;tím, e horní patro nemá stejnı pùdorys jako dolní.
<p class=center><a href="vrml/o_schody.wrl"><img src="img/priklad7.png" alt="Øešení 7. pøíkladu" width="343" height="258"></a>

<h2 id=notes>Poznámky na závìr</h2>
<ul>
<li>Scéna vytvoøená tímto programem sice mùe navenek vypadat velice realisticky,
ale uvnitø mùeme narazit na pomìrnì velkı nedostatek &ndash; místnosti tvoøí
nepropojené &bdquo;ostrovy&ldquo;. Existuje sice omezení, které nám garantuje
jistı minimální poèet dveøí ven, ovšem ty zaruèí pouze to, e alespoò jeden
z&nbsp;ostrovù bude propojen s&nbsp;vnìjším svìtem. Tento problém nemá ádné
jednoduché øešení. Jistım øešením by mohlo bıt pøidání omezení na scénu,
které by specifikovalo poèet uzavøenıch komponent. To ovšem naráí na problémy
hlavnì u&nbsp;vıplòovıch místností.</li>
<li>Dveøe (i&nbsp;další druhy portálù) musí bıt v&nbsp;modelu reprezentovány
pouze otvory ve stìnách, protoe jinak by byl problém s&nbsp;lícováním sobì si
odpovídajících èástí &ndash; kam se dveøe otvírají (dovnitø/ven), jaké jsou dveøe
(pravé/levé), atd. Jako další rozšíøení programu je mono zváit pøidání knihovny
dveøí, ze které se do hotového modelu pøidají dveøe do pøíslušnıch otvorù. Pokud
by tyto dveøe byly vybaveny i&nbsp;pøíslušnımi senzory, velmi snadno lze dosáhnout
vıborného dojmu.</li>
</ul>

</body>
</html>
